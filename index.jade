doctype html
html
  head
    title Ezel
    link( href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Source+Code+Pro' rel='stylesheet' type='text/css' )
    meta( name='viewport', content='width=device-width', initial-scale='1.0,user-scalable=no' )
    style
      include:styl styles.styl
  body
    a#forkme( href='https://github.com/artsy/ezel' )
      img(
        style='top: 0; right: 0; border: 0;',
        src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png',
        alt='Fork me on GitHub'
      )
    #container
      nav#menu
        for item, i in navItems
          if i == 0
            a.active( href='#' + item.toLowerCase() )= item
          else
            a( href='#' + item.toLowerCase() )= item
      != body
    script( src="http://code.jquery.com/jquery-1.10.2.min.js" )
    script(type='text/javascript').
      $(function() {
        $(window).on('scroll', function() {
          var curId;

          // If you scroll past the introduction, start the pop-lock
          if ($(window).scrollTop() > $('#introduction').offset().top + 30) {
            $('#menu').addClass('fixed');

            // If you get to the bottom the last menu item is highlighted
            if ($(window).scrollTop() + $(window).height() >= $(document).height()) {
              curId =$('h2:last-of-type').attr('id');

            // Otherwise highlight the h2 closest to the top of the window
            } else {
              curId = ($($($('h2').get().reverse()).filter(function() {
                return $(window).scrollTop() + 20 > $(this).offset().top;
              })[0]).attr('id'));
            }

            // Highlight the left-hand nav item
            $('#menu a').removeClass('active');
            var sel = '[href="#' + curId + '"]';
            $(sel).addClass('active');

          // Otherwise un-locked
          } else {
            $('#menu a').removeClass('active');
            $('[href="#introduction"]').addClass('active');
            $('#menu').removeClass('fixed');
          }
        });
      });
